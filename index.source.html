<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>æŒ¯èˆˆäº”å€åŠ ç¢¼åˆ¸é€ŸæŸ¥</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:image" content="https://onlinemad.github.io/5000-lottery/cover.webp" />
  <style type="text/css">
    body {
      width: 25%;
      margin: auto;
    }

    button {
      width: 100%;
      height: 25pt;
    }

    .main {
      text-align: center;
    }

    .main .notice {
      color: firebrick;
    }

    .main textarea {
      width: 95%;
      font-size: 20pt;
    }

    .result-title {
      text-align: center;
    }

    .footer {
      color: dimgrey;
      text-align: center;
      margin: 20pt auto;
      line-height: 18pt;
    }

    #result {
      margin-bottom: 20pt;
    }

    #result li {
      list-style: none;
    }

    #result li::before {
      content: 'ğŸ€„'
    }

    @media only screen and (max-device-width : 375px) {
      body {
        width: 95%;
      }
    }

    @media only screen and (min-device-width : 375px) and (max-device-width : 667px) {
      body {
        width: 75%;
      }
    }
  </style>
</head>

<body onload="loadUid()">
  <div class="main">
    <h1>æŒ¯èˆˆäº”å€åŠ ç¢¼åˆ¸é€ŸæŸ¥</h1>
    <p>
      <small>æ–°å¢ã€ç¬¬ä¸‰é€±ã€‘åœ°æ–¹å‰µç”Ÿåˆ¸</small><br />
      <small class="notice">éå®˜æ–¹ï¼ŒåŠ ç¢¼åˆ¸èªªæ˜è«‹çœ‹<a href="https://5000.gov.tw/" target="_blank">æŒ¯èˆˆäº”å€åˆ¸å®˜ç¶²</a></small>
    </p>
    <div>
      <textarea id="uid" rows="5" placeholder="è«‹è¼¸å…¥èº«åˆ†è­‰å­—è™Ÿï¼ˆè‡³å°‘è¼¸å…¥æœ«ä¸‰ç¢¼ï¼‰ï¼Œç”¨ , åˆ†é–‹å¤šç­†"></textarea>
      <button onclick="query()">æŸ¥è©¢</button>
    </div>
  </div>
  <div>
    <h2 class="result-title">æŸ¥è©¢çµæœ</h2>
    <div id="result">
    </div>
    <div id="mask" style="display: none;">
      <button onclick="mask()">ç¢¼æ‰èº«åˆ†è­‰å­—è™Ÿ for æˆªåœ–åˆ†äº«</button>
    </div>
  </div>
  <div class="footer">
    <small>
      ç„¡å»£å‘Šã€ç„¡è¿½è¹¤ç¢¼<br />
      èº«åˆ†è­‰å­—è™Ÿæš«å­˜åœ¨ç€è¦½å™¨å…§ï¼Œä½ ä¹Ÿå¯ä»¥<a href="#" onclick="clean()">æ¸…é™¤æš«å­˜</a> <br />
      ç¶²ç«™ä»¥<a href="https://github.com/onlinemad/5000-lottery" target="_blank">é–‹æ”¾åŸå§‹ç¢¼æ–¹å¼é‡‹å‡º</a>
    </small>
  </div>
  <button onclick="showCoverage()">é¡¯ç¤ºåˆ†ä½ˆ</button>
  <div>
    <table id="coverageTable">
    </table>
  </div>
  <div id="coverage">

  </div>
</body>
<script>
  let coupons = [{
    name: 'ã€ç¬¬ä¸€é€±ã€‘åœ‹æ—…åˆ¸',
    codes: ['21', '32', '98', '67', '97', '410']
  }, {
    name: 'ã€ç¬¬ä¸€é€±ã€‘iåŸåˆ¸',
    codes: ['64', '85']
  }, {
    name: 'ã€ç¬¬ä¸€é€±ã€‘è¾²éŠåˆ¸',
    codes: ['89', '32', '54', '597', '453', '152']
  }, {
    name: 'ã€ç¬¬ä¸€é€±ã€‘è—funåˆ¸(æ•¸ä½)',
    codes: ['96', '15', '07', '30', '73', '98', '19', '11']
  }, {
    name: 'ã€ç¬¬ä¸€é€±ã€‘è—funåˆ¸(ç´™æœ¬)',
    codes: ['39', '37', '23', '36', '79', '08', '14', '75']
  }, {
    name: 'ã€ç¬¬ä¸€é€±ã€‘å‹•æ»‹åˆ¸',
    codes: ['97', '13', '19', '55', '71', '93', '381', '734', '644', '453', '985']
  }, {
    name: 'ã€ç¬¬ä¸€é€±ã€‘å®¢åº„åŠµ2.0',
    codes: ['81', '900']
  }, {
    name: 'ã€ç¬¬ä¸€é€±ã€‘åœ°æ–¹å‰µç”Ÿåˆ¸',
    codes: ['081', '105', '594', '188', '089', '396', '521', '467', '912', '798', '358', '441', '367', '941', '335']
  }, {
    name: 'ã€ç¬¬äºŒé€±ã€‘åœ‹æ—…åˆ¸',
    codes: ['87', '04', '40', '29', '71']
  }, {
    name: 'ã€ç¬¬äºŒé€±ã€‘iåŸåˆ¸',
    codes: ['12', '59']
  }, {
    name: 'ã€ç¬¬äºŒé€±ã€‘è¾²éŠåˆ¸',
    codes: ['50', '13']
  }, {
    name: 'ã€ç¬¬äºŒé€±ã€‘è—funåˆ¸(æ•¸ä½)',
    codes: ['78', '00', '39', '22', '61', '23', '15']
  }, {
    name: 'ã€ç¬¬äºŒé€±ã€‘è—funåˆ¸(ç´™æœ¬)',
    codes: ['37', '76', '31', '06', '51', '65', '81']
  }, {
    name: 'ã€ç¬¬äºŒé€±ã€‘å‹•æ»‹åˆ¸',
    codes: ['91', '11', '04', '18', '57', '498', '756']
  }, {
    name: 'ã€ç¬¬äºŒé€±ã€‘å®¢åº„åŠµ2.0',
    codes: ['11', '439', '841', '052', '206', '161', '457', '205', '012', '293', '446', '589']
  }, {
    name: 'ã€ç¬¬äºŒé€±ã€‘åœ°æ–¹å‰µç”Ÿåˆ¸',
    codes: ['598', '880', '886', '675', '684', '568', '645', '456']
  }, {
    name: 'ã€ç¬¬ä¸‰é€±ã€‘åœ‹æ—…åˆ¸',
    codes: ['44', '34', '09', '55', '35', '041']
  }, {
    name: 'ã€ç¬¬ä¸‰é€±ã€‘iåŸåˆ¸',
    codes: ['48', '49']
  }, {
    name: 'ã€ç¬¬ä¸‰é€±ã€‘è¾²éŠåˆ¸',
    codes: ['60', '75']
  }, {
    name: 'ã€ç¬¬ä¸‰é€±ã€‘è—funåˆ¸(æ•¸ä½)',
    codes: ['01', '92', '19', '23', '79', '95', '48', '46']
  }, {
    name: 'ã€ç¬¬ä¸‰é€±ã€‘è—funåˆ¸(ç´™æœ¬)',
    codes: ['31', '56', '02', '52', '44', '49', '00', '47', '59']
  }, {
    name: 'ã€ç¬¬ä¸‰é€±ã€‘å‹•æ»‹åˆ¸',
    codes: ['82', '45', '57', '53', '00', '546', '855', '865', '012', '983']
  }, {
    name: 'ã€ç¬¬ä¸‰é€±ã€‘å®¢åº„åŠµ2.0',
    codes: ['14', '269']
  }, {
    name: 'ã€ç¬¬ä¸‰é€±ã€‘åœ°æ–¹å‰µç”Ÿåˆ¸',
    codes: ['711', '706', '064', '168', '191', '459', '135', '314', '366']
  }]

  let rs = []

  let search = (ids, coupons) => {
    let _rs = ids.map((id) => {
      let winning = []
      coupons.map((coupon) => {
        coupon.codes.map((code) => {
          if (id.slice(-code.length) === code) {
            winning.push(`${coupon.name} [${code}]`)
          }
        })
      })
      return {
        id: id,
        winning: winning
      }
    })
    return _rs
  }

  let uid = null

  function loadUid() {
    uid = document.getElementById('uid')
    uid.value = localStorage.getItem('uid')
  }

  function render(_rs) {
    let result = document.getElementById('result')
    result.innerHTML = ''
    _rs.map((r) => {
      let h3 = document.createElement('h3')
      h3.appendChild(document.createTextNode(r.id))
      result.appendChild(h3)

      let span = document.createElement('span')
      if (r.winning.length > 0) {
        let ul = document.createElement('ul')
        r.winning.map((w) => {
          let li = document.createElement('li')
          li.appendChild(document.createTextNode(w))
          ul.appendChild(li)
        })
        result.appendChild(ul)
      } else {
        span.appendChild(document.createTextNode('éƒ½æ²’ä¸­'))
        result.appendChild(span)
      }
    })
  }

  function query() {
    uid.style.display = null

    let uids = uid.value.split(',').map((_uid) => _uid.trim())
    localStorage.setItem('uid', uids.toString())

    rs = search(uids, coupons)
    render(rs)
    document.getElementById('mask').style.display = 'block'
  }

  function mask() {
    uid.style.display = 'none'
    render(rs.map((r) => {
      r.id = r.id.replace(/[a-z\d]/gi, '*')
      return r
    }))
  }

  function clean() {
    uid.value = ''
    uid.style.display = null
    localStorage.removeItem('uid')
    rs = []
    render(rs)
    document.getElementById('mask').style.display = 'none'
  }

  function showCoverage(){
    let coverageTable = document.getElementById('coverageTable')
    coverageTable.innerHTML = ''
    let ttl = [0,0,0,0,0,0,0,0]
    for(i=0;i<1000;i+=25){
      let tr = document.createElement('tr')
      for(j=0;j<25;j++){
        let td = document.createElement('td')
        let n = pad(i+j,3)

        let w = 0
        coupons.map((coupon) => {
          coupon.codes.map((code) => {
            if (n.slice(-code.length) === code) {
              w++
            }
          })
        })

        td.appendChild(document.createTextNode(`${n}[${w}]`))
        let c = (((16-(w*2))+(-2*Math.sign(w)))*16).toString(16)
        td.style.backgroundColor = `#${c}FF${c}`;
        ttl[w]++
        tr.appendChild(td)
      }
      coverageTable.appendChild(tr)
    }
    let coverage = document.getElementById('coverage')
    let ttlsum = 0
    for(i=7;i>0;i--){
      ttlsum += ttl[i];
      let pct = ttl[i] / 10
      let pctt = ttlsum / 10
      if(ttlsum>0){
        coverage.appendChild(document.createTextNode(`ä¸­${i}å¼µ [${pct}%] ç´¯è¨ˆå…± [${pctt}%]`))
        coverage.appendChild(document.createElement('br'))
      }
    }
    let pct = ttl[0] / 10
    coverage.appendChild(document.createTextNode(`ä»€éº¼éƒ½æ²’ä¸­ [${pct}%]`))
  }

  function pad (str, max) {
    str = str.toString();
    return str.length < max ? pad("0" + str, max) : str;
  }
</script>

</html>