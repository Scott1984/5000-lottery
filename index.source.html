<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>加碼券速查</title>
  <style type="text/css">
    body {
      width: 25%;
      margin: auto;
    }
    .main {
      text-align: center;
    }
    .main textarea {
      width: 95%;
    }
    .main button {
      width: 100%;
      height: 25pt;
    }
    .result-title {
      text-align: center;
    }
    @media only screen 
    and (min-device-width : 375px) 
    and (max-device-width : 667px) {
      body {
        width: 75%;
      }
    }
  </style>
</head>

<body onload="loadUid()">
  <div class="main">
    <h1>加碼券速查</h1>
    <div>
      <textarea id="uid" rows="10" placeholder="請輸入身分證字號，用 , 分開多筆"></textarea>
    </div>
    <div>
      <button onclick="query()">查詢</button>
    </div>
  </div>
  <div>
    <h2 class="result-title">查詢結果</h2>
    <div id="result">
    </div>
  </div>
</body>
<script>
  let coupons = [{
    name: '國旅券',
    codes: ['21', '32', '98', '67', '97', '410']
  }, {
    name: 'i原券',
    codes: ['64', '85']
  }, {
    name: '農遊券',
    codes: ['89', '32', '54', '597', '453', '152']
  }, {
    name: '藝fun券(數位)',
    codes: ['96', '15', '07', '30', '73', '98', '19', '11']
  }, {
    name: '藝fun券(紙本)',
    codes: ['39', '37', '23', '36', '79', '08', '14', '75']
  }]

  let search = (ids, coupons) => {
    let rs = []
    ids.map((id) => {
      let winning = []
      coupons.map((coupon) => {
        coupon.codes.map((code) => {
          if (id.slice(-code.length) === code) {
            winning.push(`${coupon.name}[${code}]`)
          }
        })
      })
      rs.push({
        id: id,
        winning: winning
      })
    })
    return rs
  }

  function loadUid () {
    let uid = localStorage.getItem('uid')
    document.getElementById('uid').value = uid
  }

  function query () {
    let uid = document.getElementById('uid').value
    localStorage.setItem('uid', uid)
    let uids = uid.split(',')

    let rs = search(uids, coupons)

    let result = document.getElementById('result')
    result.innerHTML = ''
    rs.map((r) => {
      let h3 = document.createElement('h3')
      h3.appendChild(document.createTextNode(r.id))
      result.appendChild(h3)

      let span = document.createElement('span')
      let winning = r.winning.length > 0 ? `中：${r.winning.toString()}` : '都沒中'
      span.appendChild(document.createTextNode(winning))
      result.appendChild(span)
    })
  }
</script>

</html>